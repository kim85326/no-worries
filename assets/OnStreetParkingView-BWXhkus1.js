import{f as _,g as P,a as k,L as D,M as x,d as C,s as g,c as $}from"./date-CFhx2LZB.js";import{d as I,r as u,c as T,o as O,a as F,b as N,e as m,t as A,f as l,w as h,u as r}from"./index-Cgm_eSMV.js";const L=["href"],W=I({__name:"OnStreetParkingView",setup(R){const f=u(!0),s=u([]),S=u(null);async function w(){try{const p=P(),n="/no-worries",[t,a]=await Promise.all([k.get("https://tdx.transportdata.tw/api/basic/v1/Parking/OnStreet/ParkingSegmentAvailability/City/Taichung?%24format=JSON",{headers:{"X-Forwarded-For":p}}),k.get(`${n}/tc-parking.json`)]);console.log("dynamicParkingResponse: ",t.data),console.log("parkingInfoResponse: ",a.data);const d=t.data.CurbParkingSegmentAvailabilities.map(e=>{var o,v;const i=a.data.ParkingSegments.find(c=>c.ParkingSegmentID===e.ParkingSegmentID);return i?{parkingSegmentID:e.ParkingSegmentID,parkingSegmentName:{zh_tw:e.ParkingSegmentName.Zh_tw},totalSpaces:e.TotalSpaces,availableSpaces:e.AvailableSpaces,availabilities:e.Availabilities.map(c=>({spaceType:c.SpaceType,numberOfSpaces:c.NumberOfSpaces,availableSpaces:c.AvailableSpaces})),serviceStatus:e.ServiceStatus,fullStatus:e.FullStatus,chargeStatus:e.ChargeStatus,dataCollectTime:e.DataCollectTime,updateTime:new Date(e.DataCollectTime),latitude:(o=i.ParkingSegmentPosition)==null?void 0:o.PositionLat,longitude:(v=i.ParkingSegmentPosition)==null?void 0:v.PositionLon,fareDescription:i.FareDescription}:null}).filter(e=>e!==null).filter(e=>e.availabilities.some(i=>i.numberOfSpaces>0));console.log("mergedData: ",d),s.value=d}catch(p){console.error("Error:",p)}finally{f.value=!1}}async function b(){const n=await new D({apiKey:x,version:"weekly"}).load(),t=new n.maps.Map(S.value,{center:C,zoom:13});s.value.forEach(a=>{if(a.latitude&&a.longitude){const d=a.availableSpaces/a.totalSpaces,e=o=>o>.5?"#4CAF50":o>.3?"#FFC107":"#F44336",i=new n.maps.Circle({strokeColor:e(d),strokeOpacity:.8,strokeWeight:2,fillColor:e(d),fillOpacity:.35,map:t,center:{lat:a.latitude,lng:a.longitude},radius:50+a.availableSpaces*5});new n.maps.InfoWindow({content:`
          <div style="padding: 8px">
            <h3 style="margin: 0 0 8px">${a.parkingSegmentName.zh_tw}</h3>
            <p style="margin: 4px 0">可用車位: ${a.availableSpaces}/${a.totalSpaces}</p>
            <p style="margin: 4px 0">費率: ${a.fareDescription}</p>
            <a href="https://www.google.com/maps/dir/?api=1&destination=${a.latitude},${a.longitude}"
              target="_blank"
              style="display: inline-block; margin-top: 8px; color: #1a73e8; text-decoration: none">
              在 Google Maps 導航 →
            </a>
          </div>
        `}),i.addListener("click",()=>{new n.maps.InfoWindow({content:`
          <div style="padding: 8px">
            <h3 style="margin: 0 0 8px">${a.parkingSegmentName.zh_tw}</h3>
            <p style="margin: 4px 0">可用車位: ${a.availableSpaces}/${a.totalSpaces}</p>
            <p style="margin: 4px 0">費率: ${a.fareDescription}</p>
          </div>
        `,position:{lat:a.latitude,lng:a.longitude}}).open(t)})}})}const y=T(()=>s.value.length>0?_(s.value[0].updateTime):"");return O(async()=>{await w(),await b()}),(p,n)=>(F(),N("div",null,[m("div",{ref_key:"mapDiv",ref:S,style:{height:"500px","margin-bottom":"20px"}},null,512),m("p",null,"更新時間："+A(y.value),1),l(r($),{value:s.value,loading:f.value,paginator:"",rows:100,sortField:"availableSpaces",sortOrder:-1},{default:h(()=>[l(r(g),{field:"parkingSegmentName.zh_tw",sortable:"",header:"名稱"}),l(r(g),{field:"totalSpaces",sortable:"",header:"總車位"}),l(r(g),{field:"availableSpaces",sortable:!0,header:"可用車位"}),l(r(g),{field:"fareDescription",header:"費率說明"}),l(r(g),{header:"導航"},{body:h(t=>[m("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${t.data.latitude},${t.data.longitude}`,target:"_blank",class:"nav-link"}," GO ",8,L)]),_:1})]),_:1},8,["value","loading"])]))}});export{W as default};
