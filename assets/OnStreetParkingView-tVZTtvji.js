import{f as y,g as _,a as v,L as P,M as D,d as x,s as c,b as C}from"./date-gtU_td5v.js";import{d as $,r as u,c as I,o as T,a as O,b as F,e as m,t as N,f as l,w as k,u as r}from"./index-DWIhrXV8.js";const A=["href"],z=$({__name:"OnStreetParkingView",setup(L){const f=u(!0),s=u([]),S=u(null);async function h(){try{const p=_(),[i,n]=await Promise.all([v.get("https://tdx.transportdata.tw/api/basic/v1/Parking/OnStreet/ParkingSegmentAvailability/City/Taichung?%24format=JSON",{headers:{"X-Forwarded-For":p}}),v.get("/tc-parking.json")]);console.log("dynamicParkingResponse: ",i.data),console.log("parkingInfoResponse: ",n.data);const a=i.data.CurbParkingSegmentAvailabilities.map(e=>{var g,o;const t=n.data.ParkingSegments.find(d=>d.ParkingSegmentID===e.ParkingSegmentID);return t?{parkingSegmentID:e.ParkingSegmentID,parkingSegmentName:{zh_tw:e.ParkingSegmentName.Zh_tw},totalSpaces:e.TotalSpaces,availableSpaces:e.AvailableSpaces,availabilities:e.Availabilities.map(d=>({spaceType:d.SpaceType,numberOfSpaces:d.NumberOfSpaces,availableSpaces:d.AvailableSpaces})),serviceStatus:e.ServiceStatus,fullStatus:e.FullStatus,chargeStatus:e.ChargeStatus,dataCollectTime:e.DataCollectTime,updateTime:new Date(e.DataCollectTime),latitude:(g=t.ParkingSegmentPosition)==null?void 0:g.PositionLat,longitude:(o=t.ParkingSegmentPosition)==null?void 0:o.PositionLon,fareDescription:t.FareDescription}:null}).filter(e=>e!==null).filter(e=>e.availabilities.some(t=>t.numberOfSpaces>0));console.log("mergedData: ",a),s.value=a}catch(p){console.error("Error:",p)}finally{f.value=!1}}async function w(){const i=await new P({apiKey:D,version:"weekly"}).load(),n=new i.maps.Map(S.value,{center:x,zoom:13});s.value.forEach(a=>{if(a.latitude&&a.longitude){const e=a.availableSpaces/a.totalSpaces,t=o=>o>.5?"#4CAF50":o>.3?"#FFC107":"#F44336",g=new i.maps.Circle({strokeColor:t(e),strokeOpacity:.8,strokeWeight:2,fillColor:t(e),fillOpacity:.35,map:n,center:{lat:a.latitude,lng:a.longitude},radius:50+a.availableSpaces*5});new i.maps.InfoWindow({content:`
          <div style="padding: 8px">
            <h3 style="margin: 0 0 8px">${a.parkingSegmentName.zh_tw}</h3>
            <p style="margin: 4px 0">可用車位: ${a.availableSpaces}/${a.totalSpaces}</p>
            <p style="margin: 4px 0">費率: ${a.fareDescription}</p>
            <a href="https://www.google.com/maps/dir/?api=1&destination=${a.latitude},${a.longitude}" 
              target="_blank" 
              style="display: inline-block; margin-top: 8px; color: #1a73e8; text-decoration: none">
              在 Google Maps 導航 →
            </a>
          </div>
        `}),g.addListener("click",()=>{new i.maps.InfoWindow({content:`
          <div style="padding: 8px">
            <h3 style="margin: 0 0 8px">${a.parkingSegmentName.zh_tw}</h3>
            <p style="margin: 4px 0">可用車位: ${a.availableSpaces}/${a.totalSpaces}</p>
            <p style="margin: 4px 0">費率: ${a.fareDescription}</p>
          </div>
        `,position:{lat:a.latitude,lng:a.longitude}}).open(n)})}})}const b=I(()=>s.value.length>0?y(s.value[0].updateTime):"");return T(async()=>{await h(),await w()}),(p,i)=>(O(),F("div",null,[m("div",{ref_key:"mapDiv",ref:S,style:{height:"500px","margin-bottom":"20px"}},null,512),m("p",null,"更新時間："+N(b.value),1),l(r(C),{value:s.value,loading:f.value,paginator:"",rows:100,sortField:"availableSpaces",sortOrder:-1},{default:k(()=>[l(r(c),{field:"parkingSegmentName.zh_tw",sortable:"",header:"名稱"}),l(r(c),{field:"totalSpaces",sortable:"",header:"總車位"}),l(r(c),{field:"availableSpaces",sortable:!0,header:"可用車位"}),l(r(c),{field:"fareDescription",header:"費率說明"}),l(r(c),{header:"導航"},{body:k(n=>[m("a",{href:`https://www.google.com/maps/dir/?api=1&destination=${n.data.latitude},${n.data.longitude}`,target:"_blank",class:"nav-link"}," GO ",8,A)]),_:1})]),_:1},8,["value","loading"])]))}});export{z as default};
